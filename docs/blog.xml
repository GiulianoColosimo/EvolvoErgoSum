<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Evolvo Ergo Sum</title>
<link>https://giulianocolosimo.github.io/EvolvoErgoSum/blog.html</link>
<atom:link href="https://giulianocolosimo.github.io/EvolvoErgoSum/blog.xml" rel="self" type="application/rss+xml"/>
<description>Ecology, Evolution with a sprinkle of Technology</description>
<generator>quarto-1.3.433</generator>
<lastBuildDate>Mon, 20 Nov 2023 23:00:00 GMT</lastBuildDate>
<item>
  <title>A test of HWE using permutations (to be completed)</title>
  <dc:creator>Giuliano Colosimo</dc:creator>
  <link>https://giulianocolosimo.github.io/EvolvoErgoSum/posts/chisq_permutation/index.html</link>
  <description><![CDATA[ 



<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Working with microsatellite genotypes data for many years I always wanted to fully understand how to build a test to verify whether the population(s) under analysis is(are) in Hardy-Weinberg (HW) equilibrium <span class="citation" data-cites="Hardy1908">(Hardy, 1908)</span> (or, to be more precise, if the population’s genotypes reflects HW proportions). Checking for HW proportions is generally the first step in any kind of population genetic analysis <span class="citation" data-cites="Waples2019">(Waples <em>et al.</em>, 2018)</span>.</p>
<p>One of the most basic approach to perform such a test is to use the <img src="https://latex.codecogs.com/png.latex?%5Cchi%5E%7B2%7D"> method <span class="citation" data-cites="Allendorf2022">(Allendorf <em>et al.</em>, 2022)</span>. This approach is particularly useful when the number of loci and alleles is too big to perform a Fisher’s Exact Test <span class="citation" data-cites="Fisher1935">(Fisher, 1935)</span>. The straight up formula of the <img src="https://latex.codecogs.com/png.latex?%5Cchi%5E%7B2%7D"> test is relatively simple: <img src="https://latex.codecogs.com/png.latex?%5Cchi%5E%7B2%7D%20=%20%5Csum%5Cfrac%7B(OBSERVED-EXPECTED)%5E2%7D%7BEXPECTED%7D">, where OBSERVED and EXPECTED refer to the number of observed and expected genotypes for each locus and allele. The <img src="https://latex.codecogs.com/png.latex?%5Cchi%5E%7B2%7D"> value obtained is then compared to a set of values obtained under the assumption of no violation of the <img src="https://latex.codecogs.com/png.latex?H_0">.</p>
<div class="cell">
<details>
<summary>Show the R code used to produce the graph</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">chiTestVal <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb1-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.001</span>)</span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pchisq</span>(chiTestVal, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">df =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), chiTestVal, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>,</span>
<span id="cb1-5">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(chi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"distribution"</span>),</span>
<span id="cb1-6">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Test Statistic Value"</span>,</span>
<span id="cb1-7">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"p-value"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb1-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pchisq</span>(chiTestVal, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">df =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), chiTestVal, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>,</span>
<span id="cb1-9">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>)</span>
<span id="cb1-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pchisq</span>(chiTestVal, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">df =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>), chiTestVal, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>,</span>
<span id="cb1-11">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>)</span>
<span id="cb1-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pchisq</span>(chiTestVal, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">df =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>), chiTestVal, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>,</span>
<span id="cb1-13">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"brown"</span>)</span>
<span id="cb1-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pchisq</span>(chiTestVal, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">df =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>), chiTestVal, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>,</span>
<span id="cb1-15">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"deeppink"</span>)</span>
<span id="cb1-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">v=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb1-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, </span>
<span id="cb1-18">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DoF = 1"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DoF = 2"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DoF = 3"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DoF = 4"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DoF = 5"</span>), </span>
<span id="cb1-19">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"brown"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"deeppink"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-chisq" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://giulianocolosimo.github.io/EvolvoErgoSum/posts/chisq_permutation/index_files/figure-html/fig-chisq-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1: <img src="https://latex.codecogs.com/png.latex?%5Cchi%5E%7B2%7D"> distribution graph showing the test statistic on the y axis and its associated p-value on the x axis. The test statistic is calculated with different Degrees of Freedom (DoF). The red dashed line marks the widely used threshold of p-value = 0.05 under which we can reject <img src="https://latex.codecogs.com/png.latex?H_0">. As DoF increases, the test statistic value needed to reject <img src="https://latex.codecogs.com/png.latex?H_0"> gets higher.</figcaption>
</figure>
</div>
</div>
</div>
<p>While the <img src="https://latex.codecogs.com/png.latex?%5Cchi%5E%7B2%7D"> test is applied in many different situations, there are some cases, for example when there are many genotypes with low expected numbers due the presence of many different alleles, where a different approach may serve us better in testing <img src="https://latex.codecogs.com/png.latex?H_0">: permutation tests <span class="citation" data-cites="Allendorf2022">(Allendorf <em>et al.</em>, 2022)</span>.</p>
<p>The overall idea behind this approach is to recreate X number of randomized datasets starting from the observed data. For each generated dataset a <img src="https://latex.codecogs.com/png.latex?%5Cchi%5E%7B2%7D"> value is then calculated and compared with the value obtained from the original dataset. The prorportion of randomized dataset that produce a <img src="https://latex.codecogs.com/png.latex?%5Cchi%5E%7B2%7D"> value as large as or lager than the observed data give us an unbiased estimate of the probability of rejecting <img src="https://latex.codecogs.com/png.latex?H_0"> <span class="citation" data-cites="Allendorf2022">(Allendorf <em>et al.</em>, 2022)</span>.</p>
<p>In this post I will show how I build a permutation test procedure to evaluate the probability if rejecting <img src="https://latex.codecogs.com/png.latex?H_0"> when working with microsatellite genotypes. I will be using a microsatellite dataset available from Dryad (click <a href="https://drive.proton.me/urls/W9206FWP1C#LlZJdXqsWypn">here</a> to download). The dataset is borrowed from <span class="citation" data-cites="Chan2020">Chan <em>et al.</em> (2020)</span> and consists of 27 microsatellites typed in 237 individuals. The original dataset is available in <strong><font color="green"> genpop </font></strong> format. This is a widely used format in R applications. The procedure illustrated here works directly with matrices. Therefore in this first part of the post I will cover the step-by-step procedure to transition from <strong><font color="green"> genpop </font></strong> to <strong><font color="green"> matrix </font></strong>.</p>
</section>
<section id="data-wrangling" class="level1">
<h1>Data wrangling</h1>
<p>First thing to do is to load the data file using the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(adegenet)                                    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># package to load</span></span>
<span id="cb2-2">sceloporus_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.genepop</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"path/to/file.gen"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># specify the path to the genepop file</span></span>
<span id="cb2-3">                                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncode =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,           <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># how many digits are used for alleles</span></span>
<span id="cb2-4">                                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quiet =</span> T)           <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print loading progress on screen</span></span></code></pre></div>
</div>
<p>The <em>read.genepop()</em> function from <strong>adegenet</strong> <span class="citation" data-cites="Jombart2008a">(Jombart, 2008)</span> automatically converts the data in to a <strong><font color="green"> genind </font></strong> object, the data format used by <strong>adegenet</strong>. We can take a look at what it is like just by typing the name of data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">sceloporus_data</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>/// GENIND OBJECT /////////

 // 237 individuals; 27 loci; 442 alleles; size: 499.2 Kb

 // Basic content
   @tab:  237 x 442 matrix of allele counts
   @loc.n.all: number of alleles per locus (range: 3-35)
   @loc.fac: locus factor for the 442 columns of @tab
   @all.names: list of allele names for each locus
   @ploidy: ploidy of each individual  (range: 2-2)
   @type:  codom
   @call: read.genepop(file = "~/Documents/websites/EvolvoErgoSum/data/doi_10.5061_dryad.sxksn0316__v2/microsatellite_genotypes.gen", 
    ncode = 3, quiet = T)

 // Optional content
   @pop: population of each individual (group size range: 6-76)</code></pre>
</div>
</div>
<p>This data format is quite useful as it gives a first glance of what is that we are dealing with. Unfortunately this is not the format needed to perform this custom test so we first need to transform the data a bit. In fact this permutation procedure takes as input file a matrix of genotypes. Rather than giving you an example right now I think is best if we proceed and transform the dataset so that you can see how the input file should look like. The first step is to transform the data object in a data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">sceloporus_data_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">genind2df</span>(sceloporus_data)</span>
<span id="cb5-2">sceloporus_data_df[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              pop sa5220 sa5229 sa6002 sa6012  sar80  sar84 sarms0001 sarms0344
DJL286  TCWC93505 109112 233233 121129 146146 362398 117123    207207    251251
DJL297  TCWC93505 109109 201225 121129 134140 350358 117117    199199    242242
DL924   TCWC93505 109112 185185 121129 146152   &lt;NA&gt; 117117    207207    242245
DL925   TCWC93505 109112 221241 121121 142144 374382 117117    207199    251251
ESP9057 TCWC93505 109109 225221 121121 136136 378378 117117    207207    242242
ESP9070 TCWC93505 109112 205229 121121 140144 374374 117117    207199    251242
ESP9479 TCWC93505 109109 229237 121121 146144 350354 117135    207207    251251
ESP9480 TCWC93505 109109 201229 121121 134128 354353 117135    207207    251242
ESP9485 TCWC93505 109112 233225 121121 128138 350353 117135    207207    251251
ESP9486 TCWC93505 109112 225245 129117 140140 350382 117131    207207    242242</code></pre>
</div>
</div>
<p>By inspecting the first 10 individuals and 9 loci we notice that the function has nicely organized our individuals in rows, kept the population information in the first column, and used the other columns for the genotypes. This format is very close to what we need, but not quite yet. First, we change the coding scheme of missing genotypes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">sceloporus_data_df[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(sceloporus_data_df, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, is.na)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"000000"</span></span>
<span id="cb7-2">sceloporus_data_df[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              pop sa5220 sa5229 sa6002 sa6012  sar80  sar84 sarms0001 sarms0344
DJL286  TCWC93505 109112 233233 121129 146146 362398 117123    207207    251251
DJL297  TCWC93505 109109 201225 121129 134140 350358 117117    199199    242242
DL924   TCWC93505 109112 185185 121129 146152 000000 117117    207207    242245
DL925   TCWC93505 109112 221241 121121 142144 374382 117117    207199    251251
ESP9057 TCWC93505 109109 225221 121121 136136 378378 117117    207207    242242
ESP9070 TCWC93505 109112 205229 121121 140144 374374 117117    207199    251242
ESP9479 TCWC93505 109109 229237 121121 146144 350354 117135    207207    251251
ESP9480 TCWC93505 109109 201229 121121 134128 354353 117135    207207    251242
ESP9485 TCWC93505 109112 233225 121121 128138 350353 117135    207207    251251
ESP9486 TCWC93505 109112 225245 129117 140140 350382 117131    207207    242242</code></pre>
</div>
</div>
<p>Just a few more lines of code to transform everything from a data frame to a matrix and retain all the information that may be useful down the road.</p>
<div class="cell">
<details>
<summary>Show the R code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">sceloporus_data_mt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(sceloporus_data_df[,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x){</span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">substr</span>(x, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">substr</span>(x, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/"</span>)</span>
<span id="cb9-3">})</span>
<span id="cb9-4">sceloporus_data_mt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(sceloporus_data_df[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]), sceloporus_data_mt)</span>
<span id="cb9-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(sceloporus_data_mt) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(sceloporus_data_df)</span>
<span id="cb9-6">sceloporus_data_mt[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>]</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                    sa5220    sa5229    sa6002    sa6012    sar80     sar84    
DJL286  "TCWC93505" "109/112" "233/233" "121/129" "146/146" "362/398" "117/123"
DJL297  "TCWC93505" "109/109" "201/225" "121/129" "134/140" "350/358" "117/117"
DL924   "TCWC93505" "109/112" "185/185" "121/129" "146/152" "000/000" "117/117"
DL925   "TCWC93505" "109/112" "221/241" "121/121" "142/144" "374/382" "117/117"
ESP9057 "TCWC93505" "109/109" "225/221" "121/121" "136/136" "378/378" "117/117"
ESP9070 "TCWC93505" "109/112" "205/229" "121/121" "140/144" "374/374" "117/117"
ESP9479 "TCWC93505" "109/109" "229/237" "121/121" "146/144" "350/354" "117/135"
ESP9480 "TCWC93505" "109/109" "201/229" "121/121" "134/128" "354/353" "117/135"
ESP9485 "TCWC93505" "109/112" "233/225" "121/121" "128/138" "350/353" "117/135"
ESP9486 "TCWC93505" "109/112" "225/245" "129/117" "140/140" "350/382" "117/131"</code></pre>
</div>
</div>
</section>
<section id="next-step-coming-soon" class="level1">
<h1>Next step coming soon…</h1>
</section>
<section id="references" class="level1">




</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Allendorf2022" class="csl-entry">
Allendorf, F.W., Funk, W.C., Aitken, S.N., Byrne, M., Luikart, G. and Antunes, A. 2022. <em><a href="https://doi.org/10.1093/oso/9780198856566.001.0001"><span class="nocase">Conservation and the Genomics of Populations</span></a></em>. Oxford University Press.
</div>
<div id="ref-Chan2020" class="csl-entry">
Chan, L.M., Painter, C.W., Hill, M.T., Hibbitts, T.J., Leavitt, D.J., Ryberg, W.A., <em>et al.</em> 2020. <a href="https://doi.org/10.1371/journal.pone.0238194">Phylogeographic structure of the dunes sagebrush lizard, an endemic habitat specialist</a>. <em><span>PLOS</span> <span>ONE</span></em>, <strong>15</strong>: e0238194. Public Library of Science (<span>PLoS</span>).
</div>
<div id="ref-Fisher1935" class="csl-entry">
Fisher, R.A. 1935. <a href="https://doi.org/10.1111/j.2397-2335.1935.tb04208.x">The logic of inductive inference</a>. <em>Journal of the Royal Statistical Society</em>, <strong>98</strong>: 39–54.
</div>
<div id="ref-Hardy1908" class="csl-entry">
Hardy, G.H. 1908. <a href="https://doi.org/10.1126/science.28.706.49">Mendelian proportions in a mixed population</a>. <em>Science</em>, <strong>28</strong>: 49–50.
</div>
<div id="ref-Jombart2008a" class="csl-entry">
Jombart, T. 2008. <a href="https://doi.org/10.1093/bioinformatics/btn129"><span class="nocase">adegenet: a R package for the multivariate analysis of genetic markers.</span></a> <em>Bioinformatics</em>, <strong>24</strong>: 1403–1405.
</div>
<div id="ref-Waples2019" class="csl-entry">
Waples, R.S., Rus Hoelzel, A., Gaggiotti, O., Tiedemann, R., Palsbøll, P.J., Cipriano, F., <em>et al.</em> 2018. Guidelines for genetic data analysis. <em>Journal of Cetacean Research and Management</em>, <strong>18</strong>: 33–80.
</div>
</div></section></div> ]]></description>
  <category>R</category>
  <category>Chi square</category>
  <category>Permutation</category>
  <category>Statistics</category>
  <guid>https://giulianocolosimo.github.io/EvolvoErgoSum/posts/chisq_permutation/index.html</guid>
  <pubDate>Mon, 20 Nov 2023 23:00:00 GMT</pubDate>
</item>
<item>
  <title>Translocation of Cyclura carinata from Little Water Cay to Grouper Cay.</title>
  <dc:creator>Giuliano Colosimo</dc:creator>
  <link>https://giulianocolosimo.github.io/EvolvoErgoSum/posts/translocation/index.html</link>
  <description><![CDATA[ 



<p>This summer, in the midst of the heat wave of late July and early August, we performed a translocation of <em>Cyclura carinata</em> individuals, the Turks and Caicos Rock Iguana, from Little Water Cay to Grouper Cay! Keep reading if you want to know more about this project and how it came about.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://giulianocolosimo.github.io/EvolvoErgoSum/posts/translocation/cycar.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">A young <em>Cyclura carinata</em> individual. (Photo credits: G. Colosimo)</figcaption>
</figure>
</div>
<p><em>Cyclura carinata</em> is endemic to the Turks and Caicos Islands (TCI), a small and beautiful archipelago located north of Hispaniola Island (Haiti and Dominican Republic), in the Caribbean Sea. A species is defined endemic when it is native to a specific region and when it naturally can be found only in that particular area. Turks and Caicos Rock Iguanas is, in fact, native to the TCI and can only be found in this archipelago. The only exception is represented by a small population of TCI Rock Iguanas found on Booby Cay, The Bahamas. Genetic studies have recently demonstrated that the Booby Cay population is the outcome of a past introduction event <span class="citation" data-cites="Welch2017">(Welch <em>et al.</em>, 2017)</span>. Once occupying almost every single island in the TCI, the distribution range of <em>C carinata</em> dramatically decreased and they are considered extirpated from ca. 95% of their former range <span class="citation" data-cites="Gerber2007">(Gerber, 2007)</span>.</p>
<div class="cell">
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-3192220d2f77f3326bb4" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-3192220d2f77f3326bb4">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addMarkers","args":[21.8347,-72.1497,null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},"Little Water Cay, the source population",null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addMarkers","args":[21.8826,-72.0776,null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},"Grouper Cay, the site selected for translocation",null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[21.8347,21.8826],"lng":[-72.1497,-72.0776]}},"evals":[],"jsHooks":[]}</script>
<p>An interactive map showing the Turks and Caicos Archipelago and the relative position of source and recipient sites used for the translocation.</p>
</div>
</div>
<p>The progressive reduction of their range, largely due to the intense development and construction activity on many islands, and the presence of introduced feral mammals (cats, dogs, rats, donkeys, pigs), caused, in 2004, the listing of this species as Critically Endangered (CR) in the International Union for the Conservation of Nature (IUCN) Red-List of Threatened Species <span class="citation" data-cites="Gerber2004a">(Gerber, 2004)</span>. This means that there is a concrete risk of extinction if no management actions are pursued.</p>
<p>A group of international researchers and volunteers, collaborating with local institutions like the Department of Environment and Coastal Resources (DECR) and the Turks and Caicos National Trust (TCINT), has been working for many years to ensure that this species could persist and thrive in its natural habitat. Thanks to their work, the implementation of different conservation strategies, and the involvement of local communities, the species has recently been down-listed from CR to Endangered (EN) in the IUCN Red-List of Threatened Species <span class="citation" data-cites="Gerber2020">(Gerber <em>et al.</em>, 2020)</span>. Although this represents very good news, it does not mean that conservation efforts can come to a stop. On the contrary, as the species persistence is still challenged by new development and the presence of introduced feral mammals, the level of guard and attention should not dim.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://giulianocolosimo.github.io/EvolvoErgoSum/posts/translocation/cychead.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">A young adult with its bead tag. The colored beads allow for an easy and effective way to remotely identifying the individual without the necessity to capture it. Each color corresponds to a number and a combination of different colors provides the individual numeric identifier. In this case only the white bead is present, indicating that this is individual number 1. (Photo credits: G. Colosimo)</figcaption>
</figure>
</div>
<p>Among different conservation strategies, individuals translocation has proven an effective measure for TCI iguanas. A translocation of individuals entails the collection of adults (or young adults) from a source population to be introduced in a recipient area, usually identified within the historical range of a species. If no historical areas are available or known, a new location can also be selected as recipient area, as long as it presents the appropriate characteristics for the species to thrive.</p>
<p>A first translocation program was conducted in 2002 and 2003 <span class="citation" data-cites="Gerber2004 Gerber2007">(Gerber <em>et al.</em>, 2004; Gerber, 2007)</span>. This year, following up on an intensive project to eradicate invasive mammals from some of the islands in the vicinity of Providenciales, another translocation was performed. Between July and August 2023 we moved 74 adults from Little Water Cay to Grouper Cay. The project authorized by the Scientific Research Permit No.&nbsp;2023-06-30-32 issued by DECR, was funded through a Darwin grant and leaded by senior research scientist Dr.&nbsp;Glenn Gerber (San Diego Zoo Wildlife Alliance). We received support from many local political institutions as well from local tour operators.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://giulianocolosimo.github.io/EvolvoErgoSum/posts/translocation/georgeandflesh.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Flesh, a representative of the Department of Environment and Coastal Resources, with an adult male <em>Cyclura carinata</em>. Flesh is receiving help from George, a volunteer with years of field experience in the Turks and Caicos Islands. (Photo credits: Dodly).</figcaption>
</figure>
</div>
<p>Once captured, individuals are measured and sexed to make sure that an equal ratio of males and females are moved. Every individual is also assigned a unique identifier (Passive Integrated Trasponder-PIT), very much like the transponders that are used for house cats and dogs. These identifiers will ensure that, if recaptured in the future, that individual will be recognized as one of the animals already sampled. This is a more permanent solution to the application of colored beads. As beads are exposed, they can, eventually, fall from the animal following a fight between individual or the mating between males and females or simply because the wire used for attaching them to the nucal crest breaks.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://giulianocolosimo.github.io/EvolvoErgoSum/posts/translocation/joemorgannick.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Joe (left, U.S. National Park Service), Morgan (center, local tour operato) and Nickoy (right, Turks and Caicos National Trust), while preparing a young adult for the application of beads and radio frequency identifier (RFID) transponder. (Photo credits: G. Colosimo)</figcaption>
</figure>
</div>
<p>In future years it will be necessary to monitor the recipient island of Grouper Cay to make sure that the translocated animals have successfully acclimated to the new island. The best way to monitor the success of a translocation is to document the reproduction of the translocated individuals. In the next few years we will monitor for the presence of hatchlings or yearlings. Stay tuned.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://giulianocolosimo.github.io/EvolvoErgoSum/posts/translocation/cycjuvi.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">A hatchling hiding in the vegetation. (Photo credits: G. Colosimo)</figcaption>
</figure>
</div>
<p>Did you like this post? Drop a comment down here or let me know by e-mail what you think of it or if you have questions or curiosities. Till next time.</p>
<p>Cheers</p>
<section id="references" class="level1">




</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Gerber2004a" class="csl-entry">
Gerber, G.P. 2004. <a href="http://dx.doi.org/10.2305/IUCN.UK.2004.RLTS.T6026A12317199.en"><span class="nocase">Cyclura carinata. The IUCN Red List of Threatened Species 2004: e.T6026A12317199.</span></a>
</div>
<div id="ref-Gerber2007" class="csl-entry">
Gerber, G.P. 2007. <span class="nocase">Turks and Caicos iguana translocation program, Bahama Archipelago</span>. In: <em>Re-introduction news. Newsletter of the IUCN/SSC re-introduction specialist group, abu dhabi, UAE.</em> (P. S. Soorae, ed), p. 53. Abu Dhabi: IUCN/SSC Re-Introduction Specialist Group.
</div>
<div id="ref-Gerber2020" class="csl-entry">
Gerber, G.P., Colosimo, G. and Grant, T.D. 2020. <a href="https://doi.org/10.2305/IUCN.UK.2020-2.RLTS.T6026A3097754.en"><span class="nocase">Cyclura carinata. The IUCN Red List of Threatened Species</span></a>.
</div>
<div id="ref-Gerber2004" class="csl-entry">
Gerber, G.P., Keener, L., Jezier, B., Czekala, N.M., MacDonald, E.A. and Alberts, A.C. 2004. <span class="nocase">Effects of translocation on the blood chemistry, hematology, and endocrinology of critically endangered Turks and Caicos iguanas, (<em>Cyclura carinata</em>)</span>. In: <em>American association of zoo veterinarians</em>, p. 568.
</div>
<div id="ref-Welch2017" class="csl-entry">
Welch, M.E., Colosimo, G., Pasachnik, S.A., Malone, C.L., Hilton, J., Long, J., <em>et al.</em> 2017. <a href="https://doi.org/10.1007/s10592-016-0922-6"><span class="nocase">Molecular variation and population structure in critically endangered Turks and Caicos Rock Iguanas: identifying intraspecific conservation units and revising subspecific taxonomy</span></a>. <em>Conservation Genetics</em>, <strong>18</strong>: 479–493.
</div>
</div></section></div> ]]></description>
  <category>Field work</category>
  <category>Conservation</category>
  <category>Cyclura</category>
  <category>Turks and Caicos</category>
  <guid>https://giulianocolosimo.github.io/EvolvoErgoSum/posts/translocation/index.html</guid>
  <pubDate>Fri, 18 Aug 2023 22:00:00 GMT</pubDate>
  <media:content url="https://giulianocolosimo.github.io/EvolvoErgoSum/posts/translocation/cycmale.png" medium="image" type="image/png" height="96" width="144"/>
</item>
<item>
  <title>Automated download of weather data from Italian monitoring stations.</title>
  <dc:creator>Giuliano Colosimo</dc:creator>
  <link>https://giulianocolosimo.github.io/EvolvoErgoSum/posts/accessing_weather_data/index.html</link>
  <description><![CDATA[ 



<p>Last year, during the Conservation Biology course I was teaching, I had planned to do a practical exercise and have the students download and analyse some historical weather data for Italy.</p>
<p>Not too long ago it was possible to download historical weather data relatively easily from a number of different websites. Unfortunately this option is no longer available and there really is only a handful of sites from which it is possible to download historical data for free.</p>
<p>One of them is <a href="https://mesonet.agron.iastate.edu/request/download.phtml">here</a>, hosted on the Iowa State University website. The user interface is pretty intuitive and it is possible to select from a pretty amazing variety of network of data from all over the world.</p>
<p>Another very cool thing about this portal is that it offers a few line of codes, in R and Python, to automate the download of the data of interest. I have tried the R script, but I couldn’t make it work “as is”. I did a few changes to the original code to make it do what it was supposed to do, and since I did it for my students I thought it would be nice to make a blog post. I here provide a full rundown on how to use the script. The description includes the installation of a few necessary packages to download historical weather data. The worked out example shows how to download data for the Italian peninsula, but with a few tweaks and changes it is possible to adapt it to download all data of interest.</p>
<p>Buckle up and lets begin. First of all, let me give you an overview of the OS and R version I am working with. After downloading the appropriate packages the code should work for all platforms. Regardless, I will start by sharing my session information.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sessionInfo</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.3.1 (2023-06-16)
Platform: aarch64-apple-darwin20 (64-bit)
Running under: macOS Ventura 13.5.2

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRblas.0.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: Europe/Rome
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

loaded via a namespace (and not attached):
 [1] htmlwidgets_1.6.2 compiler_4.3.1    fastmap_1.1.1     cli_3.6.1        
 [5] tools_4.3.1       htmltools_0.5.5   rstudioapi_0.14   yaml_2.3.7       
 [9] rmarkdown_2.22    knitr_1.42        jsonlite_1.8.5    xfun_0.39        
[13] digest_0.6.31     rlang_1.1.1       evaluate_0.21    </code></pre>
</div>
</div>
<p>So, I pretty much just opened R and didn’t attach any package but the ones that automatically are loaded when you open a new working session.</p>
<p>To accomplish this task we do need to install and load a few packages that will allow R to interact with web pages and read/download information from the specified website. The code below will install on your machine the necessary packages. Of course, you will not need this step if the packages are already installed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Installing the appropriate packages</span></span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install.packages</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jsonlite"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RCurl"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lubridate"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dplyr"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ggplot2"</span>))</span></code></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The output of the above line of code is not shown, as the packages are already installed on my machine.</p>
</div>
</div>
<p>Once installed we can load the packages in the current working session.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load packages in the working session</span></span>
<span id="cb4-2">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jsonlite"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RCurl"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lubridate"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dplyr"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ggplot2"</span>)</span>
<span id="cb4-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(x, require, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">character.only =</span> T)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: jsonlite</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: RCurl</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: lubridate</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'lubridate'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    date, intersect, setdiff, union</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: dplyr</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: ggplot2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] TRUE

[[2]]
[1] TRUE

[[3]]
[1] TRUE

[[4]]
[1] TRUE

[[5]]
[1] TRUE</code></pre>
</div>
</div>
<p>Perfect. If you have a list with all TRUE values it means that everything worked fine, and we can move on to the next steps. We can now specify 2 important variables that will be used in the automated script. We need a start and an end date that will be used to identify the time window of interest for which we would like to download the data of interest.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># specify the date boundaries of our dataset</span></span>
<span id="cb16-2">date1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ISOdate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1990</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># start date in year, month, day format</span></span>
<span id="cb16-3">date2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ISOdate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">31</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># end date in year, month, day format</span></span></code></pre></div>
</div>
<p>The second step is to set 2 other variables containing the data network infrastructure from which we want to download the data and the specific country/state of interest.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">user.network <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ASOS"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># data network</span></span>
<span id="cb17-2">user.state <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"IT"</span>)     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># state</span></span></code></pre></div>
</div>
<p>If we were to do this procedure manually directly on the ISU web page at this point we will be selecting the appropriate country/state and network from the dedicated drop down menu, as shown in Figure&nbsp;1.</p>
<div id="fig-state_net" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://giulianocolosimo.github.io/EvolvoErgoSum/posts/accessing_weather_data/data_and_network_blue.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;1: Highlighted in blue is the drop down menu that we could use on the web page to select the specific country/state and data network of interest.</figcaption>
</figure>
</div>
<p>One of the advantages of the automated procedure through R, though, is that once we have perfected the procedure for a specified the country/state and data network we can repeat the same procedure over and over with different states and or location of interest. Anyway, lets keep going with our procedure. From Figure&nbsp;1 it is possible to see that, after selecting the Italian ASOS network, a list of of available weather stations appears in the left box right underneath the <strong>Select Widget for IT_ASOS Network</strong> claim. What the web page is telling us is that of all the weather stations available for the ASOS network in Italy we can pick and choose the ones we want to download the data from. Unless we really know what we are doing and unless we know exactly the precise station we want data from we need to do a little more work to figure out how many stations are available, where they are and what is their specific ID.</p>
<p>So, using a little information taken directly from the URL bar of our browsers we can tell R to open a connection to the desired web page to download the information we need. We do this with the following few lines of code.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create and open a connection</span></span>
<span id="cb18-2">network <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(user.state, user.network, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"__"</span>)</span>
<span id="cb18-3">uri <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://mesonet.agron.iastate.edu/geojson/network/"</span>, network, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".geojson"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb18-4">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">url</span>(uri)</span>
<span id="cb18-5">jdict <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fromJSON</span>(data)</span>
<span id="cb18-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">class</span>(jdict)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "list"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(jdict)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "type"            "features"        "generation_time" "count"          </code></pre>
</div>
</div>
<p>We have created and opened a connection to a <em>.geojson</em> file from the specified webpage containing all the necessary information. All the data are then stored in an object that we have called <strong>jdict</strong>. This is a list with four elements named as indicated above. Based on the names of the list elements we can infer that the second element of the list has the features of interest to us. We can look the first 5 rows of the data frame contained in the second element of the <strong>jdict</strong> list.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(jdict[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     type   id properties.elevation properties.sname properties.time_domain
1 Feature LIMG              49.0000          Albenga             (1973-Now)
2 Feature LIEA              23.0000          Alghero             (1957-Now)
3 Feature LIBA              60.0000         Amendola             (1944-Now)
4 Feature LIPY              10.0000           Ancona             (1945-Now)
5 Feature LIMW             545.0000            Aosta             (1984-Now)
6 Feature LIQB             246.8307           Arezzo            (1978-2016)
  properties.archive_begin properties.archive_end properties.state
1               1973-01-01                   &lt;NA&gt;             &lt;NA&gt;
2               1957-06-30                   &lt;NA&gt;             &lt;NA&gt;
3               1944-01-31                   &lt;NA&gt;             &lt;NA&gt;
4               1945-04-14                   &lt;NA&gt;             &lt;NA&gt;
5               1984-06-30                   &lt;NA&gt;             &lt;NA&gt;
6               1978-09-14             2016-03-06                 
  properties.country properties.climate_site properties.wfo properties.tzname
1                 IT                      NA             NA       Europe/Rome
2                 IT                      NA             NA       Europe/Rome
3                 IT                      NA             NA       Europe/Rome
4                 IT                      NA             NA       Europe/Rome
5                 IT                      NA             NA       Europe/Rome
6                 IT                      NA             NA       Europe/Rome
  properties.ncdc81 properties.ncei91 properties.ugc_county properties.ugc_zone
1                NA                NA                    NA                  NA
2                NA                NA                    NA                  NA
3                NA                NA                    NA                  NA
4                NA                NA                    NA                  NA
5                NA                NA                    NA                  NA
6                NA                NA                    NA                  NA
  properties.county properties.sid properties.network geometry.type
1                NA           LIMG           IT__ASOS         Point
2                NA           LIEA           IT__ASOS         Point
3                NA           LIBA           IT__ASOS         Point
4                NA           LIPY           IT__ASOS         Point
5                NA           LIMW           IT__ASOS         Point
6                NA           LIQB           IT__ASOS         Point
  geometry.coordinates
1      8.1256, 44.0458
2      8.2886, 40.6311
3     15.7139, 41.5381
4     13.3603, 43.6167
5      7.3687, 45.7385
6     11.8456, 43.4597</code></pre>
</div>
</div>
<p>As anticipated, this element contains all the information we need. There are 108 stations in Italy from where we can download data. Of the many variables for each location what is more important to us is the <strong>id</strong> of each station, its <strong>properties.sname</strong>, the <strong>properties.time_domain</strong> and the <strong>geometry.coordinates</strong> of each station. In fact, as a simple exercise we can make a plot to see how and where are the stations distributed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">stationsPlot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unlist</span>(jdict<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>features<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>geometry<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coordinates), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb24-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(stationsPlot[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,], stationsPlot[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">asp =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
</div>
<div id="fig-weather_stations" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://giulianocolosimo.github.io/EvolvoErgoSum/posts/accessing_weather_data/weather_station.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;2: Location of all weather stations around available from the ISU repository.</figcaption>
</figure>
</div>
<p>It is interesting to see that there are so many stations that they can pretty much reproduce the outline and profile of the iconic Italian boot (Figure&nbsp;2)! This is all nice and good. Now lets get to the fun part. Let us say that we want to download data from ALL the stations available. Using the web interface from Figure&nbsp;1 we would be selecting all the stations from the left box, move them to the right box. Then go to the right side of the page (Figure&nbsp;3) and specify a number of things like the kind of desired output (CSV rather than TXT rather than DAT), the appropriate dates for the time window of interest and what kind of weather variable we would like data for (temperature, rain, wind, etc. etc. etc.).</p>
<div id="fig-download_protocol" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://giulianocolosimo.github.io/EvolvoErgoSum/posts/accessing_weather_data/data_and_network_red.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;3: Highlighted in red is the section of the page where to specifiy the kind of information needed, the time window of interest and the specific output format.</figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Please remember these two points. First, not all stations will have data available for the time window selected. Some stations were only recently activated and it is therefore unlikely that we will be able to get data since, for example, 1970. The other issue is related to the type of variable available for download. The only variable available for bulk download in many data network not US based is only temperature!</p>
</div>
</div>
<p>Now we create a string that contains an URL with the start date and the end date. This is the URL that would appear every time we would download manually the information from the website. At this time we still do not have any information re which station we request the data from.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1">service <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?"</span></span>
<span id="cb25-2">service <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(service, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data=all&amp;tz=Etc/UTC&amp;format=comma&amp;latlon=yes&amp;"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb25-3">service <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(service, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year1="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(date1), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&amp;month1="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">month</span>(date1), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&amp;day1="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mday</span>(date1), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&amp;"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb25-4">service <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(service, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year2="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(date2), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&amp;month2="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">month</span>(date2), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&amp;day2="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mday</span>(date2), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&amp;"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb25-5">service</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?data=all&amp;tz=Etc/UTC&amp;format=comma&amp;latlon=yes&amp;year1=1990&amp;month1=1&amp;day1=1&amp;year2=2020&amp;month2=12&amp;day2=31&amp;"</code></pre>
</div>
</div>
<p>Now we set the working directory to a dedicated folder. Note that the data could be large several GB, and it may be convenient to store them on an external hard drive.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setwd</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"path/to/your/folder/of/choice"</span>)</span></code></pre></div>
</div>
<p>OK. We are almost there. The final part of this tutorial consists in creating a loop that will take the part of the URL that is constant every time and add, recursively until the very last one, the ID of the weather station we want the data from. Once again, when you run the script make sure that you have enough space on your dedicated folder and that you have enough time and a good internet connection to download all the data. Needless to say that if you first want to try the script on only a few stations you can subset the stations ID and select only 1 or 2 for a quick test.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1">it_stations_id <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> jdict<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>features<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>id</span>
<span id="cb28-2">it_stations_nm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> jdict<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>features<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>properties<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>sname</span>
<span id="cb28-3"></span>
<span id="cb28-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(it_stations_id[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])){</span>
<span id="cb28-5">  uri <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(service, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"station="</span>, it_stations_id[i], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb28-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Network:"</span>, network, </span>
<span id="cb28-7">              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Downloading:"</span>, it_stations_nm[i], it_stations_id[i], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span>))</span>
<span id="cb28-8">  data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">url</span>(uri)</span>
<span id="cb28-9">  datestring1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">format</span>(date1, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%Y%m%d"</span>)</span>
<span id="cb28-10">  datestring2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">format</span>(date2, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%Y%m%d"</span>)</span>
<span id="cb28-11">  outfn <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(network, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_"</span>, it_stations_id[i], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_"</span>, datestring1, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_to_"</span>, datestring2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb28-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">download.file</span>(uri, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(outfn, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".csv"</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"auto"</span>)</span>
<span id="cb28-13">}</span></code></pre></div>
</div>
<p>As the loop proceeds you should see information on what is being downloaded printed on your R prompt.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Depending on your internet connection it may happen that your download procedure will stop because of time out issues! Unfortunately I am yet to find a proper solution to this problem. Of course, you should make sure that you work with a stable and fast internet connection. If the issue manifests itself, and it usually does with large files, what you can do is to edit the vector of stations to download to momentary exclude the station that gives you problem, finish the download of the other stations and then come back to the one that gives problem to download it by itself.</p>
</div>
</div>
<p>Once the procedure is completed you will have all your data ready to be analysed in your folder. In the next post we will try to look at some of the downloaded data and make a few basic analysis.</p>
<p>Did you like this post? Drop a comment down here or let me know by e-mail what you think of it or if you have questions or curiosities. Till next time.</p>
<p>Cheers</p>



 ]]></description>
  <category>R</category>
  <category>Climate change</category>
  <category>Automated tasks</category>
  <guid>https://giulianocolosimo.github.io/EvolvoErgoSum/posts/accessing_weather_data/index.html</guid>
  <pubDate>Mon, 03 Jul 2023 22:00:00 GMT</pubDate>
  <media:content url="https://giulianocolosimo.github.io/EvolvoErgoSum/posts/accessing_weather_data/asos_italy.png" medium="image" type="image/png" height="160" width="144"/>
</item>
</channel>
</rss>
